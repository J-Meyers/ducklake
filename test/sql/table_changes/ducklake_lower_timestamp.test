# name: test/sql/table_changes/ducklake_lower_timestamp.test
# description: test issue #330 is fixed
# group: [table_changes]

require ducklake

require parquet

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_lower_timestamp.db' AS ducklake

statement ok
use ducklake;

statement ok
create or replace table repro (foo int, bar text, update_ts timestamptz);

statement ok
insert into repro by name select 1 as foo, '1' as bar, current_timestamp as update_ts;

statement ok
insert into repro by name select 2 as foo, '2' as bar, current_timestamp as update_ts;

statement ok
insert into repro by name select 3 as foo, '3' as bar, current_timestamp as update_ts;

# statement ok
# from table_changes('repro', current_timestamp - interval 1 week, current_timestamp);

query I
SELECT COUNT(*) FROM ducklake.table_changes('repro', 0, 4);
----
3


query I
SELECT COUNT(*) from ducklake.table_changes('repro', date '1970-01-01', now())
----
3