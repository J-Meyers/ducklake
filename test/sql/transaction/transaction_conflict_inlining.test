# name: test/sql/transaction/transaction_conflict_inlining.test
# description: Test ducklake transaction conflicts with data inlining
# group: [transaction]

require ducklake

require parquet

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_inlining_encryption.db' AS ducklake (DATA_PATH '__TEST_DIR__/ducklake_inlining_encryption_files', ENCRYPTED, DATA_INLINING_ROW_LIMIT 10000)

statement ok
CREATE TABLE ducklake.test AS SELECT i id FROM range(1000) t(i);

# two transactions try to flush the inlined data
statement ok con1
BEGIN

statement ok con1
CALL ducklake_flush_inlined_data('ducklake')

query I
SELECT COUNT(*) FROM ducklake.test
----
1000

statement ok con1
COMMIT
